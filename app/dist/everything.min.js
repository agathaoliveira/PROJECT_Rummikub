"use strict";angular.module("myApp",["ngTouch","ui.bootstrap"]),angular.module("myApp").controller("ModalDemoCtrl",["$scope","$modal","$log",function(a,b,c){a.items=["item1","item2","item3"],a.open=function(d){var e=b.open({templateUrl:"help.html",controller:"ModalInstanceCtrl",size:d,resolve:{items:function(){return a.items}}});e.result.then(function(b){a.selected=b},function(){c.info("Modal dismissed at: "+new Date)})}}]),angular.module("myApp").controller("ModalInstanceCtrl",["$scope","$modalInstance","items",function(a,b,c){a.items=c,a.selected={item:a.items[0]},a.ok=function(){b.close(a.selected.item)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("myApp").controller("CarouselDemoCtrl",["$scope",function(a){a.myInterval=5e3;var b=a.slides=[];a.addSlide=function(){var a=600+b.length+1;b.push({image:"http://placekitten.com/"+a+"/300",text:["More","Extra","Lots of","Surplus"][b.length%4]+" "+["Cats","Kittys","Felines","Cutes"][b.length%4]})};for(var c=0;4>c;c++)a.addSlide();b.push({image:"img/joker-red.png",text:["More","Extra","Lots of","Surplus"][b.length%4]+" "+["Cats","Kittys","Felines","Cutes"][b.length%4]})}]),function(){angular.module("myApp").controller("GameCtrl",["$scope","$log","$window","$animate","$timeout","stateService","gameService","gameLogicService",function(a,b,c,d,e,f,g,h){function i(a,b,c){var d=c.getBoundingClientRect();return a>=d.left&&a<d.right&&b>=d.top&&b<=d.bottom}function j(b,c,d){if(a.isYourTurn){if(!i(c,d,H))return void(w&&(D.style.display="none"));var e=m(c,d);if("touchstart"===b&&e&&-1!==a.board[e.row][e.col]){var f=e.row,g=e.col;I={row:f,col:g},J=document.getElementById("MyPiece"+I.row+"x"+I.col),J&&(J.style["z-index"]=++K)}if(J){if("touchend"===b){if(e){var h=I,j={row:e.row,col:e.col};n(h,j)}}else if(e){var o=k(e);a.$apply(function(){var b=a.board[I.row][I.col],c=a.state["tile"+b];a.tileIndex=b,a.drag_color=c.color,a.drag_score=c.score,a.tile=c}),D.style.display="inline",G.style.display="inline",G.style.width=o.width+"px";var p=o.left-H.offsetLeft;G.style.left=p+"px",G.style.paddingBottom=o.height+"px",G.style.top=o.top+"px";var q={x:o.width/2+p-15,y:o.top+o.height/2};l(q)}("touchend"===b||"touchcancel"===b||"touchleave"===b)&&(D.style.display="none",G.style.display="none",I=null,J=null)}}}function k(b){if(b){var c=b.row,d=b.col;if(c>=0&&y>c||c===y+a.turnIndex&&d>=0&&d<a.board[c].length){var e=document.getElementById("MyPiece"+c+"x"+d).parentElement.getBoundingClientRect();return e}return void 0}return void 0}function l(a){void 0!==a&&(F.setAttribute("x1",a.x),F.setAttribute("x2",a.x),E.setAttribute("y1",a.y),E.setAttribute("y2",a.y))}function m(c,d){var e=c-L.parentElement.offsetLeft,f=d-L.offsetTop,g=-1,h=-1;if(e>0&&f>0&&e<L.clientWidth&&f<L.clientHeight)g=Math.floor(y*f/L.clientHeight),h=Math.floor(z*e/L.clientWidth),b.info("row: "+g),b.info("col: "+h);else{var i=M.getBoundingClientRect();e=c-i.left,f=d-i.top,e>0&&f>0&&e<M.clientWidth&&f<M.clientHeight&&(g=y+a.turnIndex,h=Math.floor(a.board[g].length*e/M.clientWidth),b.info("row: "+g),b.info("col: "+h))}return-1!==g?{row:g,col:h}:null}function n(c,d){a.$apply(function(){try{a.boardCellClicked(c.row,c.col),a.boardCellClicked(d.row,d.col);var e="Dragged to "+d.row+"x"+d.col;b.info(e),a.msg=e}catch(f){return b.info(f.message),void(a.debug=f.message)}})}function o(){g.makeMove(h.createPickMove(a.turnIndex,a.state))}function p(c){if(A=!1,!r(c.stateAfterMove)||c.stateBeforeMove||0!==c.turnIndexBeforeMove||0!==c.turnIndexAfterMove){a.isYourTurn=c.turnIndexAfterMove>=0&&c.yourPlayerIndex===c.turnIndexAfterMove,C=c.turnIndexAfterMove,x=-1===c.turnindexAfterMove,a.yourPlayerIndex=c.yourPlayerIndex,a.turnIndex=c.turnIndexAfterMove,a.state=c.stateAfterMove,a.board=c.stateAfterMove.board,a.nexttile=c.stateAfterMove.trace.nexttile,a.playerHand=a.board[a.rows+a.turnIndex],a.sortDisabled=!1;for(var d=0;d<a.playerHand.length;d++)if(-1===a.playerHand[d]){a.sortDisabled=!0;break}a.isYourTurn,B=a.isYourTurn&&""===c.playersInfo[c.yourPlayerIndex].playerId,B&&(a.isYourTurn=!1,e(o,500),a.debug="Computer makes pick move")}else{var f=0,i=2;try{var j=h.createInitialMove(f,i);c.yourPlayerIndex=0,g.makeMove(j)}catch(k){b.info(k.message)}}}function q(a){for(var b=0;b<a.length;b++)if(-1===a[b])return b;return-1}function r(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0}function s(b){return a.$$phase||a.$apply(),void 0!==b&&void 0!==a.state["tile"+b]?a.state["tile"+b]:void 0}function t(){a.activeTile=void 0,a.activeOrigin=void 0,a.from=void 0,a.to=void 0}function u(){return y+a.turnIndex}var v=!0;window.e2e_test_stateService=f;var w=!0,x=!1,y=6,z=18;a.rows=6,a.cols=18;{var A=!1,B=!1,C=null,D=document.getElementById("draggingLines"),E=document.getElementById("horizontalDraggingLine"),F=document.getElementById("verticalDraggingLine"),G=document.getElementById("MyDrag"),H=document.getElementById("gameArea"),I=null,J=null,K=200,L=document.getElementById("board-panel"),M=document.getElementById("hand-panel");document.getElementById("hand-ul")}a.shouldSlowlyAppear=function(){return void 0!==a.activeTile},a.boardCellClicked=function(c,d){if(b.info(["Clicked on cell:",c,d]),a.debug="click board cell: ("+c+","+d+")",a.isYourTurn!==!1&&-1!==c&&-1!==d)try{if(void 0===a.activeTile)-1!==a.board[c][d]&&(a.activeTile=a.board[c][d],a.from={row:c,col:d},a.debug="picking Tile"+a.activeTile+" ("+s(a.activeTile).color+","+s(a.activeTile).score+" from: ("+c+","+d+")");else{if(a.debug="row: "+c+" col: "+d+" here: "+a.board[c][d],-1===a.board[c][d]){a.to={row:c,col:d};var e={tileIndex:a.activeTile,from:a.from,to:a.to};a.debug="index: "+e.tileIndex;var f=h.createMoveMove(a.turnIndex,a.state,e);g.makeMove(f)}t()}a.$$phase||a.$apply()}catch(i){return t(),a.debug=i.message,b.info(i),!1}},a.curPlayerAreaClicked=function(){if(a.isYourTurn&&void 0!==a.activeTile&&void 0!==a.from&&a.from.row>=0&&a.from.row<a.rows){var b=a.from;try{var c={row:a.rows+a.turnIndex,col:q(a.playerHand)},d={tileIndex:a.activeTile,from:b,to:c},e=h.createMoveMove(a.turnIndex,a.state,d);g.makeMove(e)}catch(f){a.debug=f.message}t()}},a.shouldShowTileOnBoard=function(b,c){return void 0!==a.board&&-1!==a.board[b][c]},a.notJoker=function(a){var b=s(a);return void 0!==b&&"joker"!==b.color},a.isJoker=function(a){var b=s(a);return void 0!==b&&"joker"===b.color},a.getTileColor=function(a){var b=s(a);return void 0!==b?b.color:""},a.getTileScore=function(a){var b=s(a);return void 0!==b?b.score:""},a.pickBtnClicked=function(){if(a.isYourTurn)try{var b=h.createPickMove(a.turnIndex,a.state);g.makeMove(b),a.sortType="sort",a.debug="pick one tile"}catch(c){a.debug=c.message}},a.meldBtnClicked=function(){if(a.isYourTurn)try{var b=h.createMeldMove(a.turnIndex,a.state);g.makeMove(b),a.sortType="sort"}catch(c){a.debug=c.message}},a.undoBtnClicked=function(){if(a.isYourTurn)try{var b=h.createSingleUndoMove(a.turnIndex,a.state);g.makeMove(b),a.sortType="sort"}catch(c){}},a.undoAllBtnClicked=function(){if(a.isYourTurn)try{}catch(b){}},a.sortType="sort",a.setSortTypeBtnClicked=function(){if(!x){{var c,d=a.sortType,e=u();a.board[e]}try{switch(d){case"set":c="123";break;case"sort":case"123":d="score",c="color";break;case"color":c="set";break;default:c="123"}var f=h.createSortMove(a.turnIndex,a.state,d);g.makeMove(f),a.sortType=c}catch(i){b.info(i)}}},a.getTileDataValue=function(a){var b="",c=s(a);return void 0!==c&&(b=c.color+" "+c.score),b},a.canDrag=function(b){return!(!a.isYourTurn||void 0===s(b))},a.getTileByIndex=s,a.getHandTilesRange=function(){if(void 0===a.board)return[];for(var b=a.board[6+a.turnIndex].length,c=[],d=0;b>d;d++)c.push(d);return c},v&&(window.handleDragEvent=j),g.setGame({gameDeveloperEmail:"jz1371@nyu.edu",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:h.isMoveOk,updateUI:p})}])}(),function(){angular.module("myApp").filter("range",function(){return function(a,b){b=parseInt(b);for(var c=0;b>c;c++)a.push(c);return a}})}(),function(){angular.module("myApp").factory("gameLogicService",function(){function a(a){var c=a.turnIndexBeforeMove,d=a.stateBeforeMove,e=a.move;try{var f=b(d,c,e);if(!angular.equals(e,f))return!1}catch(g){return console.log(g.stack),!1}return!0}function b(a,b,j){var l=j[1].set.value;"INIT"!==l&&k(!x(a),"Game is over, you cannot move any move");var m;switch(l){case"INIT":var n=j[2].set.value.nplayers;m=c(b,n);break;case"MOVE":var o=j[3].set.value,p=o[o.length-1];m=d(b,a,p);break;case"PICK":m=e(b,a);break;case"MELD":m=f(b,a);break;case"SORT":var q=j[2].set.value;m=g(b,a,q);break;case"UNDO":m=h(b,a);break;case"UNDOALL":m=i(b,a);break;default:throw new Error("Unexpected move")}return m}function c(a,b){k(0===a,"INIT: player"+a+" is trying to move, but only player0 can play the initial move."),k(4>=b&&b>=0,"INIT: nPlayers = "+b+" is given, but only 2 - 4 players are allowed.");for(var c=[],d=0;b>d;d++)c.push(!1);for(var e=14,f=[{setTurn:{turnIndex:0}},{set:{key:"type",value:"INIT"}},{set:{key:"trace",value:{nplayers:b,initial:c,nexttile:14*b}}},{set:{key:"board",value:n(b)}},{set:{key:"deltas",value:[]}}],g=[],h=[],i=0;106>i;i++)g[i]={set:{key:"tile"+i,value:p(i)}},h[i]="tile"+i;for(var j=[],l=0;b>l;l++)for(var m=0;e>m;m++)i=l*e+m,j[i]={setVisibility:{key:"tile"+i,visibleToPlayerIndices:[l]}};return f=f.concat(g),f.push({shuffle:{keys:h}}),f=f.concat(j)}function d(a,b,c,d){var e=c.tileIndex,f=c.from,g=c.to,h=b.board,i=b.deltas,j=B(a);o(h,f.row,f.col),k(h[f.row][f.col]===e,"[MOVE] tile"+e+" is not at board["+f.row+"]["+f.col+"]"),k(-1!==e,"[MOVE] no tile at board["+f.row+"]["+f.col+"]"),o(h,g.row,g.col),k(-1===h[g.row][g.col],"[MOVE] board["+g.row+"]["+g.col+"] has been occupied by tile"+h[g.row][g.col]),k(f.row>=0&&f.row<C()||f.row===j,"[MOVE] you cannot move tiles from other player's hand"),k(g.row>=0&&g.row<C()||g.row===j,"[MOVE] you cannot move tiles to other player's hand"),b.trace.initial[a]===!1&&k(f.row===j||A(e,a,i),"[MOVE] cannot move other player's tiles on board, since you have not finished initial meld");var l=null;g.row===j&&(k(f.row===j||A(e,a,i),"[MOVE] cannot retrieve tile"+e+" back to hand becauseit is not sent by board by you in current turn"),l=[a]);var m=angular.copy(h);m[f.row][f.col]=-1,m[g.row][g.col]=e;var n=angular.copy(i),p="MOVE";return void 0!==d&&d===!0?(n.splice(n.length-1,1),p="UNDO"):n.push(c),[{setTurn:{turnIndex:a}},{set:{key:"type",value:p}},{set:{key:"board",value:m}},{set:{key:"deltas",value:n}},{setVisibility:{key:"tile"+e,visibleToPlayerIndices:l}}]}function e(a,b){var c=C()+a,d=D(b.deltas,c);k(0===d.length,"[PICK] you cannot pick, since you sent tile to board."),k(v(b,b.board,a,!0),"[PICK] you should not mess up the board, if you want to pick");var e=b.trace.nexttile;k(e>=0&&106>e,"[PICK] no more tiles  left for picking");var f=angular.copy(b.board);f[c].push(e);var g=angular.copy(b.trace);return g.nexttile=e+1,[{setTurn:{turnIndex:m(a,b.trace.nplayers)}},{set:{key:"type",value:"PICK"}},{set:{key:"board",value:f}},{set:{key:"trace",value:g}},{setVisibility:{key:"tile"+e,visibleToPlayerIndices:[a]}}]}function f(a,b){var c=b.board,d=B(a),e=b.deltas,f=D(e,d);k(0!==f.length,"[MELD] you cannot meld since no tiles sent to board in this turn"),k(v(b,c,a,b.trace.initial[a]),"[MELD] meld is not ok");var g,h=0===c[d].length;if(h===!1){h=!0;for(var i=0;i<c[d].length;i++)if(-1!==c[d][i]){h=!1;break}}g=h?{endMatch:{endMatchScores:u(a,b)}}:{setTurn:{turnIndex:m(a,b.trace.nplayers)}};for(var j=angular.copy(b.board),l=j[d].length;l>=0;l--)-1===j[d][l]&&j[d].splice(l,1);var n=angular.copy(b.trace);return n.initial[a]=!0,[g,{set:{key:"type",value:"MELD"}},{set:{key:"board",value:j}},{set:{key:"deltas",value:[]}},{set:{key:"trace",value:n}}]}function g(a,b,c){var d=angular.copy(b.board),e=d[B(a)];switch(c){case"score":case"color":e.sort(L(c,b),b);break;case"set":d[B(a)]=E(e,b);break;default:throw new error("Unexpected sort type: "+c)}return[{setTurn:{turnIndex:a}},{set:{key:"type",value:"SORT"}},{set:{key:"sorttype",value:c}},{set:{key:"board",value:d}}]}function h(a,b){var c=b.deltas,e=c[c.length-1],f={tileIndex:e.tileIndex,from:e.to,to:e.from},g=d(a,b,f,!0);return g[1].set.value="UNDO",g}function i(a,b){for(var c=b.deltas,e=c.length-1;e>=0;e--)var f=c[e],g={tileIndex:f.tileIndex,from:f.to,to:f.from},h=d(a,b,g,!0);return h[1].set.value="UNDOALL",[{setTurn:{turnIndex:a}},{set:{key:"type",value:"UNDOALL"}},{set:{key:"board",value:boardAfter}},{set:{key:"deltas",value:deltasAfter}},{setVisibility:{key:"tile"+tileToMove,visibleToPlayerIndices:visibility}}]}function j(a,b){var c=[];try{c.push(e(b,a))}catch(d){}return c}function k(a,b){if(a===!1)throw new Error(b)}function l(a,b){k(a>=0&&b>a,"checkPlayerIndex, [playerIndex:  "+a+", nPlayers: "+b)}function m(a,b){l(a,b);var c=0;return c=a===b-1?0:a+1}function n(a){for(var b=[[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]],c=0,d=14,e=0;a>e;e++){for(var f=[],g=0;d>g;g++)f.push(c),c++;b.push(f)}return b}function o(a,b,c){k(void 0!==b&&void 0!==c,"checkPositionWithinBoard: (row, col) = ("+b+","+c+") is undefined");var d=a.length,e=a[b].length;k(b>=0&&d>b&&c>=0&&e>c,"checkPositionWithinBoard: position out Of board, [row: "+b+", col: "+c+"]")}function p(a){k(a>=0&&106>a,"Illegal index");var b,c;return 104===a||105===a?(b="joker",c=0):(b=26>a?"blue":52>a?"red":78>a?"black":"orange",c=a%13+1),{color:b,score:c}}function q(a){for(var b=[],c=[],d=0;d<a.length;d++){var e=a[d];-1===e?0!==c.length&&(b.push(c),c=[]):(k(e>=0&&106>e,"tileIndex: "+e),c.push(e))}return 0!==c.length&&b.push(c),b}function r(a){var b=a.length;if(3>b||b>13)return!1;for(var c,d=0,e=0;b>e;e++){var f=a[e].color,g=a[e].score;if("joker"!==f){if(void 0===c&&(c=f),c!==f)return!1;if(0===d&&(d=g),g!==d)return!1}0!==d&&(d+=1)}return!0}function s(a){var b=a.length;if(3!==b&&4!==b)return!1;for(var c,d=[],e=0;b>e;e++){var f=a[e].color,g=a[e].score;if("joker"!==f){if(void 0===c&&(c=g),g!==c)return!1;if(-1!==d.indexOf(f))return!1;d.push(f)}}return!0}function t(a,b){for(var c=[],d=0;d<a.length;d++){var e=b["tile"+a[d]];c.push(e)}return c}function u(a,b){for(var c=[],d=0,e=b.nplayers,f=0;e>f;f++)if(f!==a){for(var g=b["player"+f].tiles,h=0,i=0;i<g.length;i++){var j=b["tile"+g[i]];h-="joker"===j.color?30:j.score}c[f]=h,d+=h}return c[a]=-d,c}function v(a,b,c,d){for(var e=[],f=0;f<C();f++)e=e.concat(q(b[f]));for(var g=0;g<e.length;g++){var h=t(e[g],a);if(!r(h)&&!s(h))return console.log("isMeldOk, invalid sets: ["+e[g]+"]"),!1}if(d===!1){var i=D(a.deltas,B(c)),j=w(a,e,i);k(j>=30,"[MELD]: you must score at least 30 (without joker tile) for your initial meld")}return!0}function w(a,b,c){for(var d=0,e=0;e<b.length;e++){for(var f=!0,g=0,h=0;h<b[e].length;h++){var i=b[e][h];if(g+=a["tile"+i].score,-1===c.indexOf(i)){f=!1;break}}f&&(d+=g)}return d}function x(a){return-1!==y(a.board,a.deltas)||z(a)}function y(a,b){for(var c=!1,d=-1,e=C();e<a.length;e++)0===a[e].length&&0===b.length?d=e:c===!1&&(c=!0);return c?d:-1}function z(a){var b=a.trace.nexttile>=106;return b}function A(a,b,c){for(var d=B(b),e=0;e<c.length;e++)if(c[e].tileIndex===a&&c[e].from.row===d)return!0;return!1}function B(a){return C()+a}function C(){return 6}function D(a,b){for(var c=[],d=0,e=0;e<a.length;e++){var f=a[e].tileIndex,g=a[e].from,h=a[e].to;if(g.row===b&&h.row!==b)d++,c.push(f);else if(g.row!==b&&h.row===b){d--;var i=c.indexOf(f);c.splice(i,1)}}return k(c.length===d,"get tiles sent wrong"),c}function E(a,b){if(0!==a.length){for(var c=angular.copy(a),d=H(c,b),e=[],f=0;f<d.length;f++)console.log("group: "+d[f]),e=e.concat(d[f]);for(var g=[],f=0;f<c.length;f++)-1===e.indexOf(c[f])&&g.push(c[f]);for(var h=F(g,b),f=0;f<h.length;f++)console.log("run: "+h[f]),e=e.concat(h[f]);for(var f=0;f<g.length;f++)-1===e.indexOf(g[f])&&e.push(g[f]);return e}}function F(a,b){if(0===a.length)return[];a.sort(L("color",b));for(var c=[],d=K(a[0],b),e=[],f=0;f<a.length;f++){var g=a[f],h=K(g,b);if(h===d&&e.push(g),h!==d||f===a.length-1){var i=G(e,b);i.length>0&&(c=c.concat(i)),d=h,e=[g]}}return c}function G(a,b){var c=[];if(0===a.length)return c;for(var d=J(a[0],b),e=[],f=0;f<a.length;f++){var g=a[f],h=J(g,b);d===h?(e.push(g),d+=1):(e.length>=3&&c.push(e),e=[g],d=h+1)}return e.length>=3&&c.push(e),c}function H(a,b){if(0===a.length)return[];a.sort(L("score",b));for(var c=[],d=J(a[0],b),e=[],f=0;f<a.length;f++){var g=a[f],h=J(g,b);if(h===d&&e.push(g),h!==d||f===a.length-1){var i=I(e,b);i.length>0&&(c=c.concat(i)),d=h,e=[g]}}return c}function I(a,b){var c=[];if(0===a.length)return c;for(var d=[],e=[],f=0;f<a.length;f++){var g=a[f],h=K(g,b);-1===d.indexOf(h)&&(d.push(h),e.push(g))}return e.length>=3&&c.push(e),c}function J(a,b){return k(void 0!==b["tile"+a],"undefined tile: tile"+a),b["tile"+a].score}function K(a,b){return k(void 0!==b["tile"+a],"undefined tile: tile"+a),b["tile"+a].color}function L(a,b){return function(c,d){var e=b["tile"+c],f=b["tile"+d];if(void 0!==e&&void 0!==f){if("score"===a)return e.score-f.score;if("color"===a)return e.color>f.color?1:e.color<f.color?-1:e.score-f.score}return 1}}return{isMoveOk:a,createMove:b,getTileByIndex:p,getPossibleMoves:j,findAllSetInHand:E,sortBy:L,createInitialMove:c,createPickMove:e,createMeldMove:f,createSingleUndoMove:h,createUndoAllMove:i,createMoveMove:d,createSortMove:g}})}();
//# sourceMappingURL=everything.min.js.map