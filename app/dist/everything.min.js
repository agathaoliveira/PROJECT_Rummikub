"use strict";angular.module("myApp",["ngTouch","ui.bootstrap"]),angular.module("myApp").controller("ModalDemoCtrl",["$scope","$modal","$log",function(a,b,c){a.items=["item1","item2","item3"],a.open=function(d){var e=b.open({templateUrl:"help.html",controller:"ModalInstanceCtrl",size:d,resolve:{items:function(){return a.items}}});e.result.then(function(b){a.selected=b},function(){c.info("Modal dismissed at: "+new Date)})}}]),angular.module("myApp").controller("ModalInstanceCtrl",["$scope","$modalInstance","items",function(a,b,c){a.items=c,a.selected={item:a.items[0]},a.ok=function(){b.close(a.selected.item)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("myApp").controller("CarouselDemoCtrl",["$scope",function(a){a.myInterval=5e3;var b=a.slides=[];a.addSlide=function(){var a=600+b.length+1;b.push({image:"http://placekitten.com/"+a+"/300",text:["More","Extra","Lots of","Surplus"][b.length%4]+" "+["Cats","Kittys","Felines","Cutes"][b.length%4]})};for(var c=0;4>c;c++)a.addSlide();b.push({image:"img/joker-red.png",text:["More","Extra","Lots of","Surplus"][b.length%4]+" "+["Cats","Kittys","Felines","Cutes"][b.length%4]})}]),function(){angular.module("myApp").controller("GameCtrl",["$scope","$log","$window","$animate","$timeout","stateService","gameService","gameLogicService",function(a,b,c,d,e,f,g,h){function i(a,b,c){var d=c.getBoundingClientRect();return a>=d.left&&a<d.right&&b>=d.top&&b<=d.bottom}function j(b,c,d){if(a.isYourTurn){if(!i(c,d,F))return void(v&&(B.style.display="none"));var e=m(c,d);if("touchstart"===b&&e&&-1!==a.board[e.row][e.col]){var f=e.row,g=e.col;G={row:f,col:g},H=document.getElementById("MyPiece"+G.row+"x"+G.col),H&&(H.style["z-index"]=++I)}if(H){if("touchend"===b){if(e){var h=G,j={row:e.row,col:e.col};n(h,j)}}else if(e){var o=k(e);a.$apply(function(){var b=a.board[G.row][G.col],c=a.state["tile"+b];a.tileIndex=b,a.drag_color=c.color,a.drag_score=c.score,a.tile=c}),B.style.display="inline",E.style.display="inline",E.style.width=o.width+"px";var p=o.left-F.offsetLeft;E.style.left=p+"px",console.log("drag left: "+E.style.left),console.log("game left: "+p),E.style.paddingBottom=o.height+"px",E.style.top=o.top+"px";var q={x:o.width/2+p-15,y:o.top+o.height/2};console.log("center: here"),l(q)}("touchend"===b||"touchcancel"===b||"touchleave"===b)&&(B.style.display="none",E.style.display="none",G=null,H=null)}}}function k(b){if(b){var c=b.row,d=b.col;if(c>=0&&w>c||c===w+a.turnIndex&&d>=0&&d<a.board[c].length){var e=document.getElementById("MyPiece"+c+"x"+d).parentElement.getBoundingClientRect();return e}return void 0}return void 0}function l(a){void 0!==a&&(D.setAttribute("x1",a.x),D.setAttribute("x2",a.x),C.setAttribute("y1",a.y),C.setAttribute("y2",a.y))}function m(c,d){var e=c-J.parentElement.offsetLeft,f=d-J.offsetTop,g=-1,h=-1;if(e>0&&f>0&&e<J.clientWidth&&f<J.clientHeight)g=Math.floor(w*f/J.clientHeight),h=Math.floor(x*e/J.clientWidth),b.info("row: "+g),b.info("col: "+h);else{var i=K.getBoundingClientRect();e=c-i.left,f=d-i.top,e>0&&f>0&&e<K.clientWidth&&f<K.clientHeight&&(g=w+a.turnIndex,h=Math.floor(a.board[g].length*e/K.clientWidth),b.info("x: "+e),b.info("row: "+g),b.info("col: "+h))}return-1!==g?{row:g,col:h}:null}function n(c,d){a.$apply(function(){try{a.boardCellClicked(c.row,c.col),a.boardCellClicked(d.row,d.col);var e="Dragged to "+d.row+"x"+d.col;b.info(e),a.msg=e}catch(f){return b.info(f.message),void(a.debug=f.message)}})}function o(){g.makeMove(h.getPossibleMoves(a.state,a.turnIndex)[0])}function p(c){if(y=!1,!r(c.stateAfterMove)||c.stateBeforeMove||0!==c.turnIndexBeforeMove||0!==c.turnIndexAfterMove)a.isYourTurn=c.turnIndexAfterMove>=0&&c.yourPlayerIndex===c.turnIndexAfterMove,A=c.turnIndexAfterMove,a.yourPlayerIndex=c.yourPlayerIndex,a.turnIndex=c.turnIndexAfterMove,a.state=c.stateAfterMove,a.board=c.stateAfterMove.board,a.nexttile=c.stateAfterMove.trace.nexttile,a.playerHand=a.board[a.rows+a.turnIndex],a.isYourTurn,z=a.isYourTurn&&""===c.playersInfo[c.yourPlayerIndex].playerId,z&&(a.isYourTurn=!1,e(o,500),a.debug="Computer makes pick move");else{var d=0,f=2;try{var i=h.createInitialMove(d,f);c.yourPlayerIndex=0,g.makeMove(i)}catch(j){b.info(j.message)}}}function q(a){for(var b=0;b<a.length;b++)if(-1===a[b])return b;return-1}function r(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0}function s(b){return a.$$phase||a.$apply(),void 0!==b&&void 0!==a.state["tile"+b]?a.state["tile"+b]:void 0}function t(){a.activeTile=void 0,a.activeOrigin=void 0,a.from=void 0,a.to=void 0}var u=!0;window.e2e_test_stateService=f;var v=!0,w=6,x=18;a.rows=6,a.cols=18;var y=!1,z=!1,A=null,B=document.getElementById("draggingLines"),C=document.getElementById("horizontalDraggingLine"),D=document.getElementById("verticalDraggingLine"),E=document.getElementById("MyDrag"),F=document.getElementById("gameArea"),G=null,H=null,I=200,J=document.getElementById("board-panel"),K=document.getElementById("hand-panel");a.shouldSlowlyAppear=function(){return void 0!==a.activeTile},a.boardCellClicked=function(c,d){if(b.info(["Clicked on cell:",c,d]),a.debug="click board cell: ("+c+","+d+")",a.isYourTurn!==!1&&-1!==c&&-1!==d)try{if(void 0===a.activeTile)-1!==a.board[c][d]&&(a.activeTile=a.board[c][d],a.from={row:c,col:d},a.debug="picking Tile"+a.activeTile+" ("+s(a.activeTile).color+","+s(a.activeTile).score+" from: ("+c+","+d+")");else{if(a.debug="row: "+c+" col: "+d+" here: "+a.board[c][d],-1===a.board[c][d]){a.to={row:c,col:d};var e={tileIndex:a.activeTile,from:a.from,to:a.to};a.debug="index: "+e.tileIndex;var f=h.createMoveMove(a.turnIndex,a.state,e);g.makeMove(f)}t()}a.$$phase||a.$apply()}catch(i){return t(),a.debug=i.message,b.info(i),!1}},a.curPlayerAreaClicked=function(){if(a.isYourTurn&&void 0!==a.activeTile&&void 0!==a.from&&a.from.row>=0&&a.from.row<a.rows){var b=a.from;try{var c={row:a.rows+a.turnIndex,col:q(a.playerHand)},d={tileIndex:a.activeTile,from:b,to:c},e=h.createMoveMove(a.turnIndex,a.state,d);g.makeMove(e)}catch(f){a.debug=f.message}t()}},a.shouldShowTileOnBoard=function(b,c){return void 0!==a.board&&-1!==a.board[b][c]},a.notJoker=function(a){var b=s(a);return void 0!==b&&"joker"!==b.color},a.isJoker=function(a){var b=s(a);return void 0!==b&&"joker"===b.color},a.getTileColor=function(a){var b=s(a);return void 0!==b?b.color:""},a.getTileScore=function(a){var b=s(a);return void 0!==b?b.score:""},a.pickBtnClicked=function(){if(a.isYourTurn){console.log("next: "+a.nexttile);try{var c=h.createPickMove(a.turnIndex,a.state);g.makeMove(c),a.debug="pick one tile"}catch(d){a.debug=d.message,b.info(d)}}},a.meldBtnClicked=function(){if(a.isYourTurn)try{var c=h.createMeldMove(a.turnIndex,a.state);g.makeMove(c)}catch(d){a.debug=d.message,b.info(d)}},a.getTileDataValue=function(a){var b="",c=s(a);return void 0!==c&&(b=c.color+" "+c.score),b},a.canDrag=function(b){return!(!a.isYourTurn||void 0===s(b))},a.getTileByIndex=s,a.getHandTilesRange=function(){if(void 0===a.board)return[];for(var b=a.board[6+a.turnIndex].length,c=[],d=0;b>d;d++)c.push(d);return c},u&&(window.handleDragEvent=j),g.setGame({gameDeveloperEmail:"jz1371@nyu.edu",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:h.isMoveOk,updateUI:p})}])}(),function(){angular.module("myApp").filter("range",function(){return function(a,b){b=parseInt(b);for(var c=0;b>c;c++)a.push(c);return a}})}(),function(){angular.module("myApp").factory("gameLogicService",function(){function a(a){var c=a.turnIndexBeforeMove,d=a.stateBeforeMove,e=a.move;try{var f=b(d,c,e);if(!angular.equals(e,f))return!1}catch(g){return console.log(g.message),!1}return!0}function b(a,b,g){var i=g[1].set.value;"INIT"!==i&&h(!u(a),"Game is over, you cannot move any move");var j;switch(i){case"INIT":var k=g[2].set.value.nplayers;j=c(b,k);break;case"MOVE":var l=g[3].set.value,m=l[l.length-1];j=d(b,a,m);break;case"PICK":j=e(b,a);break;case"MELD":j=f(b,a);break;default:throw new Error("Unexpected move")}return j}function c(a,b){h(0===a,"INIT: player"+a+" is trying to move, but only player0 can play the initial move."),h(4>=b&&b>=0,"INIT: nPlayers = "+b+" is given, but only 2 - 4 players are allowed.");for(var c=[],d=0;b>d;d++)c.push(!1);for(var e=14,f=[{setTurn:{turnIndex:0}},{set:{key:"type",value:"INIT"}},{set:{key:"trace",value:{nplayers:b,initial:c,nexttile:14*b}}},{set:{key:"board",value:k(b)}},{set:{key:"deltas",value:[]}}],g=[],i=[],j=0;106>j;j++)g[j]={set:{key:"tile"+j,value:m(j)}},i[j]="tile"+j;for(var l=[],n=0;b>n;n++)for(var o=0;e>o;o++)j=n*e+o,l[j]={setVisibility:{key:"tile"+j,visibleToPlayerIndices:[n]}};return f=f.concat(g),f.push({shuffle:{keys:i}}),f=f.concat(l)}function d(a,b,c){var d=c.tileIndex,e=c.from,f=c.to,g=b.board,i=b.deltas,j=y(a);l(g,e.row,e.col),h(g[e.row][e.col]===d,"[MOVE] tile"+d+" is not at board["+e.row+"]["+e.col+"]"),h(-1!==d,"[MOVE] no tile at board["+e.row+"]["+e.col+"]"),l(g,f.row,f.col),h(-1===g[f.row][f.col],"[MOVE] board["+f.row+"]["+f.col+"] has been occupied by tile"+g[f.row][f.col]),h(e.row>=0&&e.row<z()||e.row===j,"[MOVE] you cannot move tiles from other player's hand"),h(f.row>=0&&f.row<z()||f.row===j,"[MOVE] you cannot move tiles to other player's hand"),b.trace.initial[a]===!1&&h(e.row===j||x(d,a,i),"[MOVE] cannot move other player's tiles on board, since you have not finished initial meld");var k=null;f.row===j&&(h(e.row===j||x(d,a,i),"[MOVE] cannot retrieve tile"+d+" back to hand becauseit is not sent by board by you in current turn"),k=[a]);var m=angular.copy(g);m[e.row][e.col]=-1,m[f.row][f.col]=d;var n=angular.copy(i);return n.push(c),[{setTurn:{turnIndex:a}},{set:{key:"type",value:"MOVE"}},{set:{key:"board",value:m}},{set:{key:"deltas",value:n}},{setVisibility:{key:"tile"+d,visibleToPlayerIndices:k}}]}function e(a,b){var c=z()+a,d=A(b.deltas,c);h(0===d.length,"[PICK] you cannot pick, since you sent tile to board."),h(s(b,b.board,a,!0),"[PICK] you should not mess up the board, if you want to pick");var e=b.trace.nexttile;h(e>=0&&106>e,"[PICK] no more tiles  left for picking");var f=angular.copy(b.board);f[c].push(e);var g=angular.copy(b.trace);return g.nexttile=e+1,[{setTurn:{turnIndex:j(a,b.trace.nplayers)}},{set:{key:"type",value:"PICK"}},{set:{key:"board",value:f}},{set:{key:"trace",value:g}},{setVisibility:{key:"tile"+e,visibleToPlayerIndices:[a]}}]}function f(a,b){var c=b.board,d=y(a),e=b.deltas,f=A(e,d);console.log("SIZE; "+f.length),h(0!==f.length,"[MELD] you cannot meld since no tiles sent to board in this turn"),h(s(b,c,a,b.trace.initial[a]),"[MELD] meld is not ok");var g,i=0===c[d].length;if(i===!1){i=!0;for(var k=0;k<c[d].length;k++)if(-1!==c[d][k]){i=!1;break}}g=i?{endMatch:{endMatchScores:r(a,b)}}:{setTurn:{turnIndex:j(a,b.trace.nplayers)}};for(var l=angular.copy(b.board),m=l[d].length;m>=0;m--)-1===l[d][m]&&l[d].splice(m,1);var n=angular.copy(b.trace);return n.initial[a]=!0,[g,{set:{key:"type",value:"MELD"}},{set:{key:"board",value:l}},{set:{key:"deltas",value:[]}},{set:{key:"trace",value:n}}]}function g(a,b){var c=[];try{c.push(e(b,a))}catch(d){}return c}function h(a,b){if(a===!1)throw new Error(b)}function i(a,b){h(a>=0&&b>a,"checkPlayerIndex, [playerIndex:  "+a+", nPlayers: "+b)}function j(a,b){i(a,b);var c=0;return c=a===b-1?0:a+1}function k(a){for(var b=[[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]],c=0,d=14,e=0;a>e;e++){for(var f=[],g=0;d>g;g++)f.push(c),c++;b.push(f)}return b}function l(a,b,c){h(void 0!==b&&void 0!==c,"checkPositionWithinBoard: (row, col) = ("+b+","+c+") is undefined");var d=a.length,e=a[b].length;h(b>=0&&d>b&&c>=0&&e>c,"checkPositionWithinBoard: position out Of board, [row: "+b+", col: "+c+"]")}function m(a){h(a>=0&&106>a,"Illegal index");var b,c;return 104===a||105===a?(b="joker",c=0):(b=26>a?"blue":52>a?"red":78>a?"black":"orange",c=a%13+1),{color:b,score:c}}function n(a){for(var b=[],c=[],d=0;d<a.length;d++){var e=a[d];-1===e?0!==c.length&&(b.push(c),c=[]):(h(e>=0&&106>e,"tileIndex: "+e),c.push(e))}return 0!==c.length&&b.push(c),b}function o(a){var b=a.length;if(3>b||b>13)return!1;for(var c,d=0,e=0;b>e;e++){var f=a[e].color,g=a[e].score;if("joker"!==f){if(void 0===c&&(c=f),c!==f)return!1;if(0===d&&(d=g),g!==d)return!1}0!==d&&(d+=1)}return!0}function p(a){var b=a.length;if(3!==b&&4!==b)return!1;for(var c,d=[],e=0;b>e;e++){var f=a[e].color,g=a[e].score;if("joker"!==f){if(void 0===c&&(c=g),g!==c)return!1;if(-1!==d.indexOf(f))return!1;d.push(f)}}return!0}function q(a,b){for(var c=[],d=0;d<a.length;d++){var e=b["tile"+a[d]];c.push(e)}return c}function r(a,b){for(var c=[],d=0,e=b.nplayers,f=0;e>f;f++)if(f!==a){for(var g=b["player"+f].tiles,h=0,i=0;i<g.length;i++){var j=b["tile"+g[i]];h-="joker"===j.color?30:j.score}c[f]=h,d+=h}return c[a]=-d,c}function s(a,b,c,d){for(var e=[],f=0;f<z();f++)e=e.concat(n(b[f]));for(var g=0;g<e.length;g++){var i=q(e[g],a);if(!o(i)&&!p(i))return console.log("isMeldOk, invalid sets: ["+e[g]+"]"),!1}if(d===!1){var j=A(a.deltas,y(c)),k=t(a,e,j);h(k>=30,"[MELD]: you must score at least 30 (without joker tile) for your initial meld")}return!0}function t(a,b,c){for(var d=0,e=0;e<b.length;e++){for(var f=!0,g=0,h=0;h<b[e].length;h++){var i=b[e][h];if(g+=a["tile"+i].score,-1===c.indexOf(i)){f=!1;break}}f&&(d+=g)}return d}function u(a){return-1!==v(a.board,a.deltas)||w(a)}function v(a,b){for(var c=!1,d=-1,e=z();e<a.length;e++)0===a[e].length&&0===b.length?d=e:c===!1&&(c=!0);return c?d:-1}function w(a){var b=a.trace.nexttile>=106;return b}function x(a,b,c){for(var d=y(b),e=0;e<c.length;e++)if(c[e].tileIndex===a&&c[e].from.row===d)return!0;return!1}function y(a){return z()+a}function z(){return 6}function A(a,b){for(var c=[],d=0,e=0;e<a.length;e++){var f=a[e].tileIndex,g=a[e].from,i=a[e].to;if(g.row===b&&i.row!==b)d++,c.push(f);else if(g.row!==b&&i.row===b){d--;var j=c.indexOf(f);c.splice(j,1)}}return h(c.length===d,"get tiles sent wrong"),c}return{isMoveOk:a,createMove:b,getTileByIndex:m,getPossibleMoves:g,createInitialMove:c,createPickMove:e,createMeldMove:f,createMoveMove:d}})}();
//# sourceMappingURL=everything.min.js.map