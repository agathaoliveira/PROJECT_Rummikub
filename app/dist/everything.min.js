"use strict";angular.module("myApp",["ngTouch","ui.bootstrap"]),angular.module("myApp").controller("ModalDemoCtrl",["$scope","$modal","$log",function(a,b,c){a.items=["item1","item2","item3"],a.open=function(d){var e=b.open({templateUrl:"help.html",controller:"ModalInstanceCtrl",size:d,resolve:{items:function(){return a.items}}});e.result.then(function(b){a.selected=b},function(){c.info("Modal dismissed at: "+new Date)})}}]),angular.module("myApp").controller("ModalInstanceCtrl",["$scope","$modalInstance","items",function(a,b,c){a.items=c,a.selected={item:a.items[0]},a.ok=function(){b.close(a.selected.item)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("myApp").controller("CarouselDemoCtrl",["$scope",function(a){a.myInterval=5e3;var b=a.slides=[];a.addSlide=function(){var a=600+b.length+1;b.push({image:"http://placekitten.com/"+a+"/300",text:["More","Extra","Lots of","Surplus"][b.length%4]+" "+["Cats","Kittys","Felines","Cutes"][b.length%4]})};for(var c=0;4>c;c++)a.addSlide();b.push({image:"img/joker-red.png",text:["More","Extra","Lots of","Surplus"][b.length%4]+" "+["Cats","Kittys","Felines","Cutes"][b.length%4]})}]),function(){angular.module("myApp").controller("GameCtrl",["$scope","$log","$window","$animate","$timeout","stateService","gameService","gameLogicService","gameAIService",function(a,b,c,d,e,f,g,h,i){function j(a,b,c){var d=c.getBoundingClientRect();return a>=d.left&&a<d.right&&b>=d.top&&b<=d.bottom}function k(b,c,d){if(a.isYourTurn){if(!j(c,d,I))return void(x&&(E.style.display="none"));var e=o(c,d);if("touchstart"===b&&(console.log("active: "+a.activeTile),e&&-1!==a.board[e.row][e.col])){var f=e.row,g=e.col;J={row:f,col:g},K=document.getElementById("MyPiece"+J.row+"x"+J.col),K&&(K.style["z-index"]=++L)}if(K){if("touchend"===b){if(e){var h=J,i={row:e.row,col:e.col};p(h,i)}}else if(e){var k=m(e);a.$apply(function(){var b=a.board[J.row][J.col],c=a.state["tile"+b];a.tileIndex=b,a.drag_color=c.color,a.drag_score=c.score,a.tile=c}),E.style.display="inline",H.style.display="inline",H.style.width=k.width+"px";var q=k.left-I.offsetLeft;H.style.left=q+"px",H.style.paddingBottom=k.height+"px",H.style.top=k.top+"px";var r={x:k.width/2+q-15,y:k.top+k.height/2},s=document.getElementById("MyPiece6x0");console.log("tile: "+JSON.stringify(s.getBoundingClientRect(),null));var t=document.getElementById("hand-panel");console.log("parent: "+JSON.stringify(t.getBoundingClientRect(),null)),console.log("center: "+l(r)),console.log("container: "+l(k)),console.log("point: "+c+", "+d),console.log("gameArea"+l(q)),n(r)}("touchend"===b||"touchcancel"===b||"touchleave"===b)&&(E.style.display="none",H.style.display="none",J=null,K=null)}}}function l(a){return JSON.stringify(a,null,4)}function m(b){if(b){var c=b.row,d=b.col;if(c>=0&&z>c||c===z+a.turnIndex&&d>=0&&d<a.board[c].length){var e=document.getElementById("MyPiece"+c+"x"+d).parentElement.getBoundingClientRect();return e}return void 0}return void 0}function n(a){void 0!==a&&(G.setAttribute("x1",a.x),G.setAttribute("x2",a.x),F.setAttribute("y1",a.y),F.setAttribute("y2",a.y))}function o(c,d){var e=document.getElementById("board");console.log("padding: "+e.style.paddingLeft);var f=c-M.parentElement.offsetLeft-15,g=d-M.offsetTop,h=-1,i=-1;if(f>0&&g>0&&f<M.clientWidth&&g<M.clientHeight)h=Math.floor(z*g/M.clientHeight),i=Math.floor(A*f/M.clientWidth),b.info("row: "+h),b.info("col: "+i);else{var j=document.getElementById("hand-ul"),k=j.getBoundingClientRect();f=c-k.left,g=d-k.top,f>0&&g>0&&f<N.clientWidth&&g<N.clientHeight&&(h=z+a.turnIndex,i=Math.floor(a.board[h].length*f/N.clientWidth),b.info("row: "+h),b.info("col: "+i))}return-1!==h?{row:h,col:i}:null}function p(c,d){a.$apply(function(){try{a.boardCellClicked(c.row,c.col),a.boardCellClicked(d.row,d.col);var e="Dragged to "+d.row+"x"+d.col;b.info(e),a.msg=e}catch(f){return b.info(f.message),void(a.debug=f.message)}})}function q(){var b;return R===!1?(b=i.createComputerMove(a.turnIndex,a.state),"PICK"!==b[1].set.value&&(R=!0),void g.makeMove(b)):void(R&&(b=h.createMeldMove(a.turnIndex,a.state),g.makeMove(b),R=!1))}function r(c){if(B=!1,!t(c.stateAfterMove)||c.stateBeforeMove||0!==c.turnIndexBeforeMove||0!==c.turnIndexAfterMove){a.isYourTurn=c.turnIndexAfterMove>=0&&c.yourPlayerIndex===c.turnIndexAfterMove,D=c.turnIndexAfterMove,y=-1===c.turnindexAfterMove,a.yourPlayerIndex=c.yourPlayerIndex,a.turnIndex=c.turnIndexAfterMove,a.state=c.stateAfterMove,a.board=c.stateAfterMove.board,a.nexttile=c.stateAfterMove.trace.nexttile,a.playerHand=a.board[a.rows+a.turnIndex],a.sortDisabled=!1;for(var d=0;d<a.playerHand.length;d++)if(-1===a.playerHand[d]){a.sortDisabled=!0;break}a.isYourTurn,C=a.isYourTurn&&""===c.playersInfo[c.yourPlayerIndex].playerId,C&&(a.isYourTurn=!1,q()),Q&&0===a.state.deltas.length&&(Q=!1),Q&&0!==a.state.deltas.length&&a.undoBtnClicked()}else{var e=0,f=2;try{var i=h.createInitialMove(e,f);c.yourPlayerIndex=0,g.makeMove(i)}catch(j){b.info(j.message)}}}function s(a){for(var b=0;b<a.length;b++)if(-1===a[b])return b;return-1}function t(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0}function u(b){return a.$$phase||a.$apply(),void 0!==b&&void 0!==a.state["tile"+b]?a.state["tile"+b]:void 0}function v(){a.activeTile=void 0,a.activeOrigin=void 0,a.from=void 0,a.to=void 0}var w=!0;window.e2e_test_stateService=f;var x=!0,y=!1,z=6,A=18;a.rows=6,a.cols=18;var B=!1,C=!1,D=null,E=document.getElementById("draggingLines"),F=document.getElementById("horizontalDraggingLine"),G=document.getElementById("verticalDraggingLine"),H=document.getElementById("MyDrag"),I=document.getElementById("gameArea"),J=null,K=null,L=200,M=document.getElementById("board-panel"),N=document.getElementById("hand-panel"),O=-1,P=-1,Q=!1,R=!1;a.shouldSlowlyAppear=function(){return void 0!==a.activeTile},a.boardCellClicked=function(c,d){if(b.info(["Clicked on cell:",c,d]),a.debug="click board cell: ("+c+","+d+")",a.isYourTurn!==!1&&-1!==c&&-1!==d)try{if(void 0===a.activeTile)-1!==a.board[c][d]&&(a.activeTile=a.board[c][d],a.from={row:c,col:d},a.debug="picking Tile"+a.activeTile+" ("+u(a.activeTile).color+","+u(a.activeTile).score+" from: ("+c+","+d+")",O=c,P=d);else{if(a.debug="row: "+c+" col: "+d+" here: "+a.board[c][d],-1===a.board[c][d]){a.to={row:c,col:d};var e={tileIndex:a.activeTile,from:a.from,to:a.to};a.debug="index: "+e.tileIndex;var f=h.createMoveMove(a.turnIndex,a.state,e);g.makeMove(f)}v()}a.$$phase||a.$apply()}catch(i){return v(),a.debug=i.message,b.info(i),!1}},a.curPlayerAreaClicked=function(){if(a.isYourTurn&&void 0!==a.activeTile&&void 0!==a.from&&a.from.row>=0&&a.from.row<a.rows){var b=a.from;try{var c={row:a.rows+a.turnIndex,col:s(a.playerHand)},d={tileIndex:a.activeTile,from:b,to:c},e=h.createMoveMove(a.turnIndex,a.state,d);g.makeMove(e)}catch(f){a.debug=f.message}v()}},a.shouldShowTileOnBoard=function(b,c){return void 0!==a.board&&-1!==a.board[b][c]},a.notJoker=function(a){var b=u(a);return void 0!==b&&"joker"!==b.color},a.isJoker=function(a){var b=u(a);return void 0!==b&&"joker"===b.color},a.getTileColor=function(a){var b=u(a);return void 0!==b?b.color:""},a.getTileScore=function(a){var b=u(a);return void 0!==b?b.score:""},a.pickBtnClicked=function(){if(a.isYourTurn)try{var c=h.createPickMove(a.turnIndex,a.state);g.makeMove(c),a.sortType="sort",a.debug="pick one tile"}catch(d){b.info(d.stack),a.debug=d.message}},a.meldBtnClicked=function(){if(a.isYourTurn)try{var b=h.createMeldMove(a.turnIndex,a.state);g.makeMove(b),a.sortType="sort"}catch(c){a.debug=c.message}},a.undoBtnClicked=function(){if(a.isYourTurn)try{var b=h.createSingleUndoMove(a.turnIndex,a.state);g.makeMove(b)}catch(c){}},a.undoAllBtnClicked=function(){a.isYourTurn&&(Q=!0,a.undoBtnClicked())},a.sortType="sort",a.setSortTypeBtnClicked=function(){if(!y){var c,d=a.sortType;try{switch(d){case"sort":case"set":d="set",c="123";break;case"123":d="score",c="color";break;case"color":c="set";break;default:c="123"}var e=h.createSortMove(a.turnIndex,a.state,d);g.makeMove(e),a.sortType=c}catch(f){b.info(f)}}},a.getTileDataValue=function(a){var b="",c=u(a);return void 0!==c&&(b=c.color+" "+c.score),b},a.canDrag=function(b){return!(!a.isYourTurn||void 0===u(b))},a.getTileByIndex=u,a.getHandTilesRange=function(){if(void 0===a.board)return[];for(var b=a.board[6+a.turnIndex].length,c=[],d=0;b>d;d++)c.push(d);return c},w&&(window.handleDragEvent=k),g.setGame({gameDeveloperEmail:"jz1371@nyu.edu",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:h.isMoveOk,updateUI:r})}])}(),function(){angular.module("myApp").filter("range",function(){return function(a,b){b=parseInt(b);for(var c=0;b>c;c++)a.push(c);return a}})}(),function(){angular.module("myApp").factory("gameAIService",["gameLogicService",function(a){function b(b,d){var e=a.getPossibleMoves(b,d),f=c(e,b,d);return e[f]}function c(a,b,c){var e=0,f=0;if(1===a.length)return 0;e=d(a[0],b,c);for(var g=1;g<a.length;g++){var h=d(a[g],b,c);h>e&&(f=g,e=h)}return f}function d(b,c,d){var e=b[1].set.value;if("PICK"===e)return 0;for(var f=b[3].set.value,g=a.getTilesSentToBoardThisTurn(f,6+c),h=0,i=0;i<g.length;i++){var j=d["tile"+g[i]];h+="joker"!==j.color?j.score:d.trace.initial[c]===!0?30:0}return h}return{createComputerMove:b}}])}(),function(){angular.module("myApp").factory("gameLogicService",function(){function a(a){var c=a.turnIndexBeforeMove,d=a.stateBeforeMove,e=a.move;try{var f=b(d,c,e);if(!angular.equals(e,f))return!1}catch(g){return console.log(g.stack),!1}return!0}function b(a,b,j){var k=j[1].set.value;"INIT"!==k&&p(!C(a),"Game is over, you cannot move any move");var l,m;switch(k){case"INIT":var n=j[2].set.value.nplayers;l=c(b,n);break;case"MOVE":m=j[3].set.value;var o=m[m.length-1];l=d(b,a,o);break;case"PICK":l=e(b,a);break;case"MELD":l=f(b,a);break;case"SORT":var q=j[2].set.value;l=g(b,a,q);break;case"UNDO":l=h(b,a);break;case"COMB":m=j[3].set.value,l=i(b,a,m);break;default:throw new Error("Unexpected move")}return l}function c(a,b){p(4>=b&&b>=0,"INIT: nPlayers = "+b+" is given, but only 2 - 4 players are allowed.");for(var c=[],d=0;b>d;d++)c.push(!1);for(var e=14,f=[{setTurn:{turnIndex:0}},{set:{key:"type",value:"INIT"}},{set:{key:"trace",value:{nplayers:b,initial:c,nexttile:14*b}}},{set:{key:"board",value:s(b)}},{set:{key:"deltas",value:[]}}],g=[],h=[],i=0;106>i;i++)g[i]={set:{key:"tile"+i,value:u(i)}},h[i]="tile"+i;for(var j=[],k=0;b>k;k++)for(var l=0;e>l;l++)i=k*e+l,j[i]={setVisibility:{key:"tile"+i,visibleToPlayerIndices:[k]}};return f=f.concat(g),f.push({shuffle:{keys:h}}),f=f.concat(j)}function d(a,b,c,d){var e=c.tileIndex,f=c.from,g=c.to,h=b.board,i=b.deltas,j=G(a);t(h,f.row,f.col),p(h[f.row][f.col]===e,"[MOVE] tile"+e+" is not at board["+f.row+"]["+f.col+"]"),p(-1!==e,"[MOVE] no tile at board["+f.row+"]["+f.col+"]"),t(h,g.row,g.col),p(-1===h[g.row][g.col],"[MOVE] board["+g.row+"]["+g.col+"] has been occupied by tile"+h[g.row][g.col]),p(f.row>=0&&f.row<H()||f.row===j,"[MOVE] you cannot move tiles from other player's hand"),p(g.row>=0&&g.row<H()||g.row===j,"[MOVE] you cannot move tiles to other player's hand"),b.trace.initial[a]===!1&&p(f.row===j||F(e,a,i),"[MOVE] cannot move other player's tiles on board, since you have not finished initial meld");var k=null;g.row===j&&(p(f.row===j||F(e,a,i),"[MOVE] cannot retrieve tile"+e+" back to hand becauseit is not sent by board by you in current turn"),k=[a]);var l=angular.copy(h);l[f.row][f.col]=-1,l[g.row][g.col]=e;var m=angular.copy(i),n="MOVE";return void 0!==d&&d===!0?(m.splice(m.length-1,1),n="UNDO"):m.push(c),[{setTurn:{turnIndex:a}},{set:{key:"type",value:n}},{set:{key:"board",value:l}},{set:{key:"deltas",value:m}},{setVisibility:{key:"tile"+e,visibleToPlayerIndices:k}}]}function e(a,b){var c=H()+a,d=J(b.deltas,c);p(0===d.length,"[PICK] you cannot pick, since you sent tile to board."),p(A(b,b.board,a,!0),"[PICK] you should not mess up the board, if you want to pick");var e=b.trace.nexttile;p(e>=0&&106>e,"[PICK] no more tiles  left for picking");var f=angular.copy(b.board);f[c].push(e);var g=angular.copy(b.trace);g.nexttile=e+1;var h={setTurn:{turnIndex:r(a,b.trace.nplayers)}};return 106===g.nexttile&&(h={endMatch:{endMatchScores:z(-1,b)}}),[h,{set:{key:"type",value:"PICK"}},{set:{key:"board",value:f}},{set:{key:"deltas",value:[]}},{set:{key:"trace",value:g}},{setVisibility:{key:"tile"+e,visibleToPlayerIndices:[a]}}]}function f(a,b){var c=b.board,d=G(a),e=b.deltas,f=J(e,d);p(0!==f.length,"[MELD] you cannot meld since no tiles sent to board in this turn"),p(A(b,c,a,b.trace.initial[a]),"[MELD] meld is not ok");var g,h=0===c[d].length;if(h===!1){h=!0;for(var i=0;i<c[d].length;i++)if(-1!==c[d][i]){h=!1;break}}g=h?{endMatch:{endMatchScores:z(a,b)}}:{setTurn:{turnIndex:r(a,b.trace.nplayers)}};for(var j=angular.copy(b.board),k=j[d].length;k>=0;k--)-1===j[d][k]&&j[d].splice(k,1);var l=angular.copy(b.trace);return l.initial[a]=!0,[g,{set:{key:"type",value:"MELD"}},{set:{key:"board",value:j}},{set:{key:"deltas",value:[]}},{set:{key:"trace",value:l}}]}function g(a,b,c){var d=angular.copy(b.board),e=d[G(a)];switch(c){case"score":case"color":e.sort(R(c,b),b);break;case"set":d[G(a)]=K(e,b);break;default:throw new Error("Unexpected sort type: "+c)}return[{setTurn:{turnIndex:a}},{set:{key:"type",value:"SORT"}},{set:{key:"sorttype",value:c}},{set:{key:"board",value:d}}]}function h(a,b){var c=b.deltas,e=c[c.length-1],f={tileIndex:e.tileIndex,from:e.to,to:e.from},g=d(a,b,f,!0);return g[1].set.value="UNDO",g}function i(a,b,c){p(c.length>0,"no move to make");for(var d=angular.copy(b.board),e=0;e<c.length;e++){var f=c[e];j(f,d),d[f.from.row][f.from.col]=-1,d[f.to.row][f.to.col]=f.tileIndex}var g=angular.copy(b.trace);g.initial[a]=!0;var h=[{setTurn:{turnIndex:a}},{set:{key:"type",value:"COMB"}},{set:{key:"board",value:d}},{set:{key:"deltas",value:c}},{set:{key:"trace",value:g}}];return h}function j(a,b){p(void 0!==a.tileIndex&&void 0!==a.from,void 0!==a.to,"missing part for delta"),p(b[a.from.row][a.from.col]===a.tileIndex,"tile"+a.tileIndex+" is not at board["+a.from.row+"]["+a.from.col+"]"),p(-1===b[a.to.row][a.to.col],"position is occupied")}function k(a,b){var c=[];c.push(e(a,b));var d=[],f=angular.copy(b.board[G(a)]),g=angular.copy(f),h=n(f,b,"groupFirst"),j=h.sets,k=!0;b.trace.initial[a]===!1&&l(a,j,b)<30&&(k=!1);for(var o=angular.copy(b.board),p={row:0,col:0},q=0;q<j.length;q++){var r=m(o,p,j[q].length);if(null===r)break;for(var s=0;s<j[q].length;s++){var t={tileIndex:j[q][s],from:{row:G(a),col:g.indexOf(j[q][s])},to:{row:r.row,col:r.col+s}};d.push(t),o[t.from.row][t.from.to]=-1,o[t.to.row][t.to.col]=t.tileIndex}p={row:r.row,col:r.col+j[q].length}}if(k&&0!==d.length){var u=i(a,b,d);c.push(u)}return c}function l(a,b,c){for(var d=0,e=0;e<b.length;e++)for(var f=0;f<b[e].length;f++){var g=b[e][f],h=c["tile"+g];"joker"!==h.color&&(d+=h.score)}return d}function m(a,b,c){if(b.row>H())return null;for(var d=b.row,e=b.col,f=0,g=d;g<H();g++)for(var h=g===d?e:0,i=h;i<I();i++)if(-1===a[g][i]){f=0;for(var j=i;j<I();j++){if(-1!==a[g][j]){i=j+1;break}if(f++,0===i&&f>c)return{row:g,col:0};if(0!==i&&f>c+1)return{row:g,col:i+1};if(j===I()-1&&f>c)return{row:g,col:i+1}}}return null}function n(a,b,c){var d=a,e=[],f=[],g=[];return"groupFirst"===c?(f=N(a,b),0!==f.length&&(d=o(a,f),e=e.concat(f)),g=L(d,b),0!==g.length&&(e=e.concat(g),d=o(d,g))):(g=L(a,b),0!==g.length&&(d=o(a,g),e=e.concat(g)),f=N(d,b),0!==f.length&&(e=e.concat(f),d=o(d,f))),{sets:e,remains:d}}function o(a,b){for(var c=angular.copy(a),d=0;d<b.length;d++)for(var e=0;e<b[d].length;e++){var f=c.indexOf(b[d][e]);-1!==f&&c.splice(f,1)}return c}function p(a,b){if(a===!1)throw new Error(b)}function q(a,b){p(a>=0&&b>a,"checkPlayerIndex, [playerIndex:  "+a+", nPlayers: "+b)}function r(a,b){q(a,b);var c=0;return c=a===b-1?0:a+1}function s(a){for(var b=[[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]],c=0,d=14,e=0;a>e;e++){for(var f=[],g=0;d>g;g++)f.push(c),c++;b.push(f)}return b}function t(a,b,c){p(void 0!==b&&void 0!==c,"checkPositionWithinBoard: (row, col) = ("+b+","+c+") is undefined");var d=a.length,e=a[b].length;p(b>=0&&d>b&&c>=0&&e>c,"checkPositionWithinBoard: position out Of board, [row: "+b+", col: "+c+"]")}function u(a){p(a>=0&&106>a,"Illegal index");var b,c;return 104===a||105===a?(b="joker",c=0):(b=26>a?"blue":52>a?"red":78>a?"black":"orange",c=a%13+1),{color:b,score:c}}function v(a){for(var b=[],c=[],d=0;d<a.length;d++){var e=a[d];-1===e?0!==c.length&&(b.push(c),c=[]):(p(e>=0&&106>e,"tileIndex: "+e),c.push(e))}return 0!==c.length&&b.push(c),b}function w(a){var b=a.length;if(3>b||b>13)return!1;for(var c,d=0,e=0;b>e;e++){var f=a[e].color,g=a[e].score;if("joker"!==f){if(void 0===c&&(c=f),c!==f)return!1;if(0===d&&(d=g),g!==d)return!1}0!==d&&(d+=1)}return!0}function x(a){var b=a.length;if(3!==b&&4!==b)return!1;for(var c,d=[],e=0;b>e;e++){var f=a[e].color,g=a[e].score;if("joker"!==f){if(void 0===c&&(c=g),g!==c)return!1;if(-1!==d.indexOf(f))return!1;d.push(f)}}return!0}function y(a,b){for(var c=[],d=0;d<a.length;d++){var e=b["tile"+a[d]];c.push(e)}return c}function z(a,b){var c=[],d=b.trace.nplayers;if(-1===a)for(var e=0;d>e;e++)c.push(0);else{for(var f=0,g=0;d>g;g++)if(g!==a){for(var h=b.board[G(g)],i=0,j=0;j<h.length;j++){var k=b["tile"+h[j]];i-="joker"===k.color?30:k.score}c[g]=i,f+=i}c[a]=-f}return c}function A(a,b,c,d){for(var e=[],f=0;f<H();f++)e=e.concat(v(b[f]));for(var g=0;g<e.length;g++){var h=y(e[g],a);if(!w(h)&&!x(h))return console.log("isMeldOk, invalid sets: ["+e[g]+"]"),!1}if(d===!1){var i=J(a.deltas,G(c)),j=B(a,e,i);p(j>=30,"[MELD]: you must score at least 30 (without joker tile) for your initial meld")}return!0}function B(a,b,c){for(var d=0,e=0;e<b.length;e++){for(var f=!0,g=0,h=0;h<b[e].length;h++){var i=b[e][h];if(g+=a["tile"+i].score,-1===c.indexOf(i)){f=!1;break}}f&&(d+=g)}return d}function C(a){return-1!==D(a.board,a.deltas)||E(a)}function D(a,b){for(var c=!1,d=-1,e=H();e<a.length;e++)0===a[e].length&&0===b.length?d=e:c===!1&&(c=!0);return c?d:-1}function E(a){var b=a.trace.nexttile>=106;return b}function F(a,b,c){for(var d=G(b),e=0;e<c.length;e++)if(c[e].tileIndex===a&&c[e].from.row===d)return!0;return!1}function G(a){return H()+a}function H(){return 6}function I(){return 18}function J(a,b){for(var c=[],d=0,e=0;e<a.length;e++){var f=a[e].tileIndex,g=a[e].from,h=a[e].to;if(g.row===b&&h.row!==b)d++,c.push(f);else if(g.row!==b&&h.row===b){d--;var i=c.indexOf(f);c.splice(i,1)}}return p(c.length===d,"get tiles sent wrong"),c}function K(a,b){if(0===a.length)return a;for(var c=angular.copy(a),d=N(c,b),e=[],f=0;f<d.length;f++)console.log("group: "+d[f]),e=e.concat(d[f]);for(var g=[],h=0;h<c.length;h++)-1===e.indexOf(c[h])&&g.push(c[h]);for(var i=L(g,b),j=0;j<i.length;j++)console.log("run: "+i[j]),e=e.concat(i[j]);for(var k=0;k<g.length;k++)-1===e.indexOf(g[k])&&e.push(g[k]);return e}function L(a,b){if(0===a.length)return[];a.sort(R("color",b));for(var c=[],d=Q(a[0],b),e=[],f=0;f<a.length;f++){var g=a[f],h=Q(g,b);if(h===d&&e.push(g),h!==d||f===a.length-1){var i=M(e,b);i.length>0&&(c=c.concat(i)),d=h,e=[g]}}return c}function M(a,b){var c=[];if(0===a.length)return c;for(var d=P(a[0],b),e=[],f=0;f<a.length;f++){var g=a[f],h=P(g,b);d===h?(e.push(g),d+=1):(e.length>=3&&c.push(e),e=[g],d=h+1)}return e.length>=3&&c.push(e),c}function N(a,b){if(0===a.length)return[];a.sort(R("score",b));for(var c=[],d=P(a[0],b),e=[],f=0;f<a.length;f++){var g=a[f],h=P(g,b);if(h===d&&e.push(g),h!==d||f===a.length-1){var i=O(e,b);i.length>0&&(c=c.concat(i)),d=h,e=[g]}}return c}function O(a,b){var c=[];if(0===a.length)return c;for(var d=[],e=[],f=0;f<a.length;f++){var g=a[f],h=Q(g,b);-1===d.indexOf(h)&&(d.push(h),e.push(g))}return e.length>=3&&c.push(e),c}function P(a,b){return p(void 0!==b["tile"+a],"undefined tile: tile"+a),b["tile"+a].score}function Q(a,b){return p(void 0!==b["tile"+a],"undefined tile: tile"+a),b["tile"+a].color}function R(a,b){return function(c,d){var e=b["tile"+c],f=b["tile"+d];if(void 0!==e&&void 0!==f){if("score"===a)return e.score-f.score;if("color"===a)return e.color>f.color?1:e.color<f.color?-1:e.score-f.score}return 1}}return{isMoveOk:a,createMove:b,getTileByIndex:u,getPossibleMoves:k,findAllSetInHand:K,sortBy:R,getTilesSentToBoardThisTurn:J,createInitialMove:c,createPickMove:e,createMeldMove:f,createSingleUndoMove:h,createMoveMove:d,createSortMove:g,createCombinedMove:i}})}();
//# sourceMappingURL=everything.min.js.map