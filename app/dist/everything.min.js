"use strict";angular.module("myApp",["ngTouch","ui.bootstrap"]).constant("CONFIG",{GAME_BOARD_ROWS:6,GAME_BOARD_COLS:18,GAME_AREA_PADDING_PERCENTAGE:.02,SETTING:{verbose:!0,show_dragging_lines:!0}}),function(){angular.module("myApp").controller("GameCtrl",["$scope","$log","$window","$animate","$timeout","stateService","gameService","dragAndDropService","gameLogicService","gameAIService","CONFIG",function(a,b,c,d,e,f,g,h,i,j,k){function l(a,b){A&&console.log(void 0===b&&b===!0?JSON.stringify(a,null):a)}function m(a,b){var c=I,d=c.getBoundingClientRect();return a>=d.left&&a<d.right&&b>=d.top&&b<=d.bottom}function n(b,c,d){if(!a.isYourTurn||!m(c,d))return K.style.display="none",void(H.style.display="none");var e=t(c,d);"touchstart"===b&&o(e),N&&("touchend"===b?p(e):q(e),("touchend"===b||"touchcancel"===b||"touchleave"===b)&&(K.style.display="none",H.style.display="none",N=null))}function o(b){N=b&&-1!==a.board[b.row][b.col]?b:null}function p(b){if(b){var c=N,d=b;a.$apply(function(){try{a.boardCellClicked(c.row,c.col),a.boardCellClicked(d.row,d.col);var b="Dragged to "+d.row+"x"+d.col;l(b),a.msg=b}catch(e){return void l(e.message)}})}}function q(b){if(b){var c=r(b);a.$apply(function(){var b=a.board[N.row][N.col],c=a.state["tile"+b];a.tileIndex=b,a.drag_color=c.color,a.drag_score=c.score,a.tile=c}),H.style.display="inline",H.style.width=c.width+"px",H.style.left=c.left-I.getBoundingClientRect().left+"px",H.style.paddingBottom=c.height+"px",H.style.top=c.top+"px";var d={x:c.left-I.getBoundingClientRect().left+c.width/2-document.getElementById("game").clientWidth*a.gameAreaPaddingPercent,y:c.top+c.height/2};l("centerXY: "+d.x),s(d)}}function r(b){if(b){var c=b.row,d=b.col;if(c>=0&&D>c||c===D+a.turnIndex&&d>=0&&d<a.board[c].length){var e=document.getElementById("MyPiece"+c+"x"+d).parentElement.getBoundingClientRect();return e}return void 0}return void 0}function s(a){B&&(K.style.display="inline",void 0!==a&&(L.setAttribute("x1",a.x),L.setAttribute("x2",a.x),M.setAttribute("y1",a.y),M.setAttribute("y2",a.y)))}function t(b,c){var d=document.getElementById("board"),e=d.getBoundingClientRect(),f=b-e.left,g=c-e.top,h=-1,i=-1;if(f>0&&g>0&&f<e.width&&g<e.height)h=Math.floor(D*g/e.height),i=Math.floor(E*f/e.width);else{var j=document.getElementById("hand-ul"),k=j.getBoundingClientRect();f=b-k.left,g=c-k.top,f>0&&g>0&&f<J.clientWidth&&g<J.clientHeight&&(h=D+a.turnIndex,i=Math.floor(a.board[h].length*f/k.width))}return l("row: "+h),l("col: "+i),-1!==h?{row:h,col:i}:null}function u(){var b;return P===!1?(b=j.createComputerMove(a.turnIndex,a.state),"PICK"!==b[1].set.value&&(P=!0),void g.makeMove(b)):void(P&&(b=i.createMeldMove(a.turnIndex,a.state),g.makeMove(b),P=!1))}function v(b){if(a.isYourTurn=b.turnIndexAfterMove>=0&&b.yourPlayerIndex===b.turnIndexAfterMove,x(b.stateAfterMove)&&a.isYourTurn){var c=2;try{var d=i.createInitialMove(c);g.makeMove(d)}catch(e){l(e.message)}}else{if(a.isYourTurn){G=b.turnIndexAfterMove,C=-1===b.turnindexAfterMove,a.yourPlayerIndex=b.yourPlayerIndex,a.turnIndex=b.turnIndexAfterMove,a.state=b.stateAfterMove,a.board=b.stateAfterMove.board,a.nexttile=b.stateAfterMove.trace.nexttile,a.playerHand=a.board[a.rows+a.turnIndex],a.sortDisabled=!1;for(var f=0;f<a.playerHand.length;f++)if(-1===a.playerHand[f]){a.sortDisabled=!0;break}}F=a.isYourTurn&&""===b.playersInfo[b.yourPlayerIndex].playerId,F&&(a.isYourTurn=!1,u()),O&&0===a.state.deltas.length&&(O=!1),O&&0!==a.state.deltas.length&&a.undoBtnClicked()}}function w(a){for(var b=0;b<a.length;b++)if(-1===a[b])return b;return-1}function x(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0}function y(b){return a.$$phase||a.$apply(),void 0!==b&&void 0!==a.state["tile"+b]?a.state["tile"+b]:void 0}function z(){a.activeTile=void 0,a.activeOrigin=void 0,a.from=void 0,a.to=void 0}var A=k.SETTING.verbose,B=k.SETTING.show_dragging_lines;a.gameAreaPaddingPercent=k.GAME_AREA_PADDING_PERCENTAGE;var C=!1,D=k.GAME_BOARD_ROWS,E=k.GAME_BOARD_COLS;a.rows=D,a.cols=E;var F=!1,G=null,H=document.getElementById("MyDrag"),I=document.getElementById("gameArea"),J=document.getElementById("hand-panel"),K=document.getElementById("draggingLines"),L=document.getElementById("verticalDraggingLine"),M=document.getElementById("horizontalDraggingLine"),N=null,O=!1,P=!1;a.shouldSlowlyAppear=function(){return void 0!==a.activeTile},a.boardCellClicked=function(b,c){if(l(["Clicked on cell:",b,c]),a.isYourTurn!==!1&&-1!==b&&-1!==c)try{if(void 0===a.activeTile)-1!==a.board[b][c]&&(a.activeTile=a.board[b][c],a.from={row:b,col:c});else{if(-1===a.board[b][c]){a.to={row:b,col:c};var d={tileIndex:a.activeTile,from:a.from,to:a.to},e=i.createMoveMove(a.turnIndex,a.state,d);g.makeMove(e)}z()}a.$$phase||a.$apply()}catch(f){return z(),l(f),!1}},a.curPlayerAreaClicked=function(){if(a.isYourTurn&&void 0!==a.activeTile&&void 0!==a.from&&a.from.row>=0&&a.from.row<a.rows){var b=a.from;try{var c={row:a.rows+a.turnIndex,col:w(a.playerHand)},d={tileIndex:a.activeTile,from:b,to:c},e=i.createMoveMove(a.turnIndex,a.state,d);g.makeMove(e)}catch(f){}z()}},a.shouldShowTileOnBoard=function(b,c){return void 0!==a.board&&-1!==a.board[b][c]},a.notJoker=function(a){var b=y(a);return void 0!==b&&"joker"!==b.color},a.isJoker=function(a){var b=y(a);return void 0!==b&&"joker"===b.color},a.getTileColor=function(a){var b=y(a);return void 0!==b?b.color:""},a.getTileScore=function(a){var b=y(a);return void 0!==b?b.score:""},a.pickBtnClicked=function(){if(a.isYourTurn)try{var b=i.createPickMove(a.turnIndex,a.state);g.makeMove(b),a.sortType="sort"}catch(c){l(c.stack)}},a.meldBtnClicked=function(){if(a.isYourTurn)try{var b=i.createMeldMove(a.turnIndex,a.state);g.makeMove(b),a.sortType="sort"}catch(c){}},a.undoBtnClicked=function(){if(a.isYourTurn)try{var b=i.createSingleUndoMove(a.turnIndex,a.state);g.makeMove(b)}catch(c){}},a.undoAllBtnClicked=function(){a.isYourTurn&&(O=!0,a.undoBtnClicked())},a.sortType="sort",a.setSortTypeBtnClicked=function(){if(!C){var b,c=a.sortType;try{switch(c){case"sort":case"set":c="set",b="123";break;case"123":c="score",b="color";break;case"color":b="set";break;default:b="123"}var d=i.createSortMove(a.turnIndex,a.state,c);g.makeMove(d),a.sortType=b}catch(e){l(e)}}},a.getTileDataValue=function(a){var b="",c=y(a);return void 0!==c&&(b=c.color+" "+c.score),b},a.canDrag=function(b){return!(!a.isYourTurn||void 0===y(b))},a.getTileByIndex=y,a.getHandTilesRange=function(){if(void 0===a.board)return[];for(var b=a.board[k.GAME_BOARD_ROWS+a.turnIndex].length,c=[],d=0;b>d;d++)c.push(d);return c},window.e2e_test_stateService=f,h.addDragListener("gameArea",n),g.setGame({gameDeveloperEmail:"jz1371@nyu.edu",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:i.isMoveOk,updateUI:v})}])}(),angular.module("myApp").controller("HelpCtrl",["$scope","$modal","$log",function(a,b,c){a.items=["item1","item2","item3"],a.open=function(d){var e=b.open({templateUrl:"help.html",controller:"ModalInstanceCtrl",size:d,resolve:{items:function(){return a.items}}});e.result.then(function(b){a.selected=b},function(){c.info("Modal dismissed at: "+new Date)})}}]),angular.module("myApp").controller("ModalInstanceCtrl",["$scope","$modalInstance","items",function(a,b,c){a.items=c,a.selected={item:a.items[0]},a.ok=function(){b.close(a.selected.item)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("myApp").controller("CarouselDemoCtrl",["$scope",function(a){a.myInterval=0}]),function(){angular.module("myApp").filter("range",function(){return function(a,b){b=parseInt(b);for(var c=0;b>c;c++)a.push(c);return a}})}(),function(){angular.module("myApp").factory("gameAIService",["gameLogicService",function(a){function b(b,d){var e=a.getPossibleMoves(b,d),f=c(e,b,d);return e[f]}function c(a,b,c){var e=0,f=0;if(1===a.length)return 0;e=d(a[0],b,c);for(var g=1;g<a.length;g++){var h=d(a[g],b,c);h>e&&(f=g,e=h)}return f}function d(b,c,d){var e=b[1].set.value;if("PICK"===e)return 0;for(var f=b[3].set.value,g=a.getTilesSentToBoardThisTurn(f,6+c),h=0,i=0;i<g.length;i++){var j=d["tile"+g[i]];h+="joker"!==j.color?j.score:d.trace.initial[c]===!0?30:0}return h}return{createComputerMove:b}}])}(),function(){angular.module("myApp").factory("gameLogicService",["CONFIG",function(a){function b(b){var d=b.turnIndexBeforeMove,e=b.stateBeforeMove,f=b.move;try{var g=c(e,d,f);if(!angular.equals(f,g)){if(a.SETTING.verbose){var h=f.length,i=g.length;if(h!==i)console.log("Different length for actual move and expected move");else for(var j=0;h>j;j++)angular.equals(f[j],g[j])||(console.log("act: "+JSON.stringify(f[j])),console.log("exp: "+JSON.stringify(g[j])))}return!1}}catch(k){return!1}return!0}function c(a,b,c){var k=c[1].set.value;"INIT"!==k&&q(!D(a),"Game is over, you cannot move any move");var l,m;switch(k){case"INIT":var n=c[2].set.value.nplayers;l=d(n);break;case"MOVE":m=c[3].set.value;var o=m[m.length-1];l=e(b,a,o,null);break;case"PICK":l=f(b,a);break;case"MELD":l=g(b,a);break;case"SORT":var p=c[2].set.value;l=h(b,a,p);break;case"UNDO":l=i(b,a);break;case"COMB":m=c[3].set.value,l=j(b,a,m);break;default:throw new Error("Unexpected move")}return l}function d(a){q(4>=a&&a>=0,"INIT: nPlayers = "+a+" is given, but only 2 - 4 players are allowed.");for(var b=[],c=0;a>c;c++)b.push(!1);for(var d=14,e=[{setTurn:{turnIndex:0}},{set:{key:"type",value:"INIT"}},{set:{key:"trace",value:{nplayers:a,initial:b,nexttile:14*a}}},{set:{key:"board",value:t(a)}},{set:{key:"deltas",value:[]}}],f=[],g=[],h=0;106>h;h++)f[h]={set:{key:"tile"+h,value:v(h)}},g[h]="tile"+h;for(var i=[],j=0;a>j;j++)for(var k=0;d>k;k++)h=j*d+k,i[h]={setVisibility:{key:"tile"+h,visibleToPlayerIndices:[j]}};return e=e.concat(f),e.push({shuffle:{keys:g}}),e=e.concat(i)}function e(a,b,c,d){var e=c.tileIndex,f=c.from,g=c.to,h=b.board,i=b.deltas,j=H(a);u(h,f.row,f.col),q(h[f.row][f.col]===e,"[MOVE] tile"+e+" is not at board["+f.row+"]["+f.col+"]"),q(-1!==e,"[MOVE] no tile at board["+f.row+"]["+f.col+"]"),u(h,g.row,g.col),q(-1===h[g.row][g.col],"[MOVE] board["+g.row+"]["+g.col+"] has been occupied by tile"+h[g.row][g.col]),q(f.row>=0&&f.row<I()||f.row===j,"[MOVE] you cannot move tiles from other player's hand"),q(g.row>=0&&g.row<I()||g.row===j,"[MOVE] you cannot move tiles to other player's hand"),b.trace.initial[a]===!1&&q(f.row===j||G(e,a,i),"[MOVE] cannot move other player's tiles on board, since you have not finished initial meld");var k=null;g.row===j&&(q(f.row===j||G(e,a,i),"[MOVE] cannot retrieve tile"+e+" back to hand becauseit is not sent by board by you in current turn"),k=[a]);var l=angular.copy(h);l[f.row][f.col]=-1,l[g.row][g.col]=e;var m=angular.copy(i),n="MOVE";return void 0!==d&&d===!0?(m.splice(m.length-1,1),n="UNDO"):m.push(c),[{setTurn:{turnIndex:a}},{set:{key:"type",value:n}},{set:{key:"board",value:l}},{set:{key:"deltas",value:m}},{setVisibility:{key:"tile"+e,visibleToPlayerIndices:k}}]}function f(a,b){var c=I()+a,d=K(b.deltas,c);q(0===d.length,"[PICK] you cannot pick, since you sent tile to board."),q(B(b,b.board,a,!0),"[PICK] you should not mess up the board, if you want to pick");var e=b.trace.nexttile,f=angular.copy(b.board);f[c].push(e),f[c]=L(f[c],b);var g=angular.copy(b.trace);g.nexttile=e+1;var h={setTurn:{turnIndex:s(a,b.trace.nplayers)}};return 106===g.nexttile&&(h={endMatch:{endMatchScores:A(-1,b)}}),[h,{set:{key:"type",value:"PICK"}},{set:{key:"board",value:f}},{set:{key:"deltas",value:[]}},{set:{key:"trace",value:g}},{setVisibility:{key:"tile"+e,visibleToPlayerIndices:[a]}}]}function g(a,b){var c=b.board,d=H(a),e=b.deltas,f=K(e,d);q(0!==f.length,"[MELD] you cannot meld since no tiles sent to board in this turn"),q(B(b,c,a,b.trace.initial[a]),"[MELD] meld is not ok");for(var g=!0,h=0;h<c[d].length;h++)if(-1!==c[d][h]){g=!1;break}var i;i=g?{endMatch:{endMatchScores:A(a,b)}}:{setTurn:{turnIndex:s(a,b.trace.nplayers)}};for(var j=angular.copy(b.board),k=j[d].length;k>=0;k--)-1===j[d][k]&&j[d].splice(k,1);var l=angular.copy(b.trace);return l.initial[a]=!0,[i,{set:{key:"type",value:"MELD"}},{set:{key:"board",value:j}},{set:{key:"deltas",value:[]}},{set:{key:"trace",value:l}}]}function h(a,b,c){var d=angular.copy(b.board),e=d[H(a)];switch(c){case"score":case"color":e.sort(S(c,b),b);break;case"set":d[H(a)]=L(e,b);break;default:throw new Error("Unexpected sort type: "+c)}return[{setTurn:{turnIndex:a}},{set:{key:"type",value:"SORT"}},{set:{key:"sorttype",value:c}},{set:{key:"board",value:d}}]}function i(a,b){var c=b.deltas,d=c[c.length-1],f={tileIndex:d.tileIndex,from:d.to,to:d.from},g=e(a,b,f,!0);return g[1].set.value="UNDO",g}function j(a,b,c){q(c.length>0,"no move to make");for(var d=angular.copy(b.board),e=0;e<c.length;e++){var f=c[e];k(f,d),d[f.from.row][f.from.col]=-1,d[f.to.row][f.to.col]=f.tileIndex}var g=angular.copy(b.trace);g.initial[a]=!0;var h=[{setTurn:{turnIndex:a}},{set:{key:"type",value:"COMB"}},{set:{key:"board",value:d}},{set:{key:"deltas",value:c}},{set:{key:"trace",value:g}}];return h}function k(a,b){q(void 0!==a.tileIndex&&void 0!==a.from,void 0!==a.to,"missing part for delta"),q(b[a.from.row][a.from.col]===a.tileIndex,"tile"+a.tileIndex+" is not at board["+a.from.row+"]["+a.from.col+"]"),q(-1===b[a.to.row][a.to.col],"position is occupied")}function l(a,b){var c=[];c.push(f(a,b));var d=[],e=angular.copy(b.board[H(a)]),g=angular.copy(e),h=o(e,b,"groupFirst"),i=h.sets,k=!0;b.trace.initial[a]===!1&&m(i,b)<30&&(k=!1);for(var l=angular.copy(b.board),p={row:0,col:0},q=0;q<i.length;q++){var r=n(l,p,i[q].length);if(null===r)break;for(var s=0;s<i[q].length;s++){var t={tileIndex:i[q][s],from:{row:H(a),col:g.indexOf(i[q][s])},to:{row:r.row,col:r.col+s}};d.push(t),l[t.from.row][t.from.to]=-1,l[t.to.row][t.to.col]=t.tileIndex}p={row:r.row,col:r.col+i[q].length}}if(k&&0!==d.length){var u=j(a,b,d);c.push(u)}return c}function m(a,b){for(var c=0,d=0;d<a.length;d++)for(var e=0;e<a[d].length;e++){var f=a[d][e],g=b["tile"+f];"joker"!==g.color&&(c+=g.score)}return c}function n(a,b,c){for(var d=b.row,e=b.col,f=0,g=d;g<I();g++)for(var h=g===d?e:0,i=h;i<J();i++)if(-1===a[g][i]){f=0;for(var j=i;j<J();j++){if(-1!==a[g][j]){i=j+1;break}if(f++,0===i&&f>c)return{row:g,col:0};if(0!==i&&f>c+1)return{row:g,col:i+1};if(j===J()-1&&f>c)return{row:g,col:i+1}}}return null}function o(a,b){var c=a,d=[],e=[],f=[];return e=O(a,b),0!==e.length&&(c=p(a,e),d=d.concat(e)),f=M(c,b),0!==f.length&&(d=d.concat(f),c=p(c,f)),{sets:d,remains:c}}function p(a,b){for(var c=angular.copy(a),d=0;d<b.length;d++)for(var e=0;e<b[d].length;e++){var f=c.indexOf(b[d][e]);-1!==f&&c.splice(f,1)}return c}function q(a,b){if(a===!1)throw new Error(b)}function r(a,b){q(a>=0&&b>a,"checkPlayerIndex, [playerIndex:  "+a+", nPlayers: "+b)}function s(a,b){r(a,b);var c=0;return c=a===b-1?0:a+1}function t(a){for(var b=[[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]],c=0,d=14,e=0;a>e;e++){for(var f=[],g=0;d>g;g++)f.push(c),c++;b.push(f)}return b}function u(a,b,c){q(void 0!==b&&void 0!==c,"checkPositionWithinBoard: (row, col) = ("+b+","+c+") is undefined");var d=a.length,e=a[b].length;q(b>=0&&d>b&&c>=0&&e>c,"checkPositionWithinBoard: position out Of board, [row: "+b+", col: "+c+"]")}function v(a){q(a>=0&&106>a,"Illegal index");var b,c;return 104===a||105===a?(b="joker",c=0):(b=26>a?"blue":52>a?"red":78>a?"black":"orange",c=a%13+1),{color:b,score:c}}function w(a){for(var b=[],c=[],d=0;d<a.length;d++){var e=a[d];-1===e?0!==c.length&&(b.push(c),c=[]):(q(e>=0&&106>e,"tileIndex: "+e),c.push(e))}return 0!==c.length&&b.push(c),b}function x(a){var b=a.length;if(3>b||b>13)return!1;for(var c,d=0,e=0;b>e;e++){var f=a[e].color,g=a[e].score;if("joker"!==f){if(void 0===c&&(c=f),c!==f)return!1;if(0===d&&(d=g),g!==d)return!1}0!==d&&(d+=1)}return!0}function y(a){var b=a.length;if(3!==b&&4!==b)return!1;for(var c,d=[],e=0;b>e;e++){var f=a[e].color,g=a[e].score;if("joker"!==f){if(void 0===c&&(c=g),g!==c)return!1;if(-1!==d.indexOf(f))return!1;d.push(f)}}return!0}function z(a,b){for(var c=[],d=0;d<a.length;d++){var e=b["tile"+a[d]];c.push(e)}return c}function A(a,b){var c=[],d=b.trace.nplayers;if(-1===a)for(var e=0;d>e;e++)c.push(0);else{for(var f=0,g=0;d>g;g++)if(g!==a){for(var h=b.board[H(g)],i=0,j=0;j<h.length;j++){var k=b["tile"+h[j]];i-="joker"===k.color?30:k.score}c[g]=i,f+=i}c[a]=-f}return c}function B(a,b,c,d){for(var e=[],f=0;f<I();f++)e=e.concat(w(b[f]));for(var g=0;g<e.length;g++){var h=z(e[g],a);if(!x(h)&&!y(h))return!1}if(d===!1){var i=K(a.deltas,H(c)),j=C(a,e,i);q(j>=30,"[MELD]: you must score at least 30 (without joker tile) for your initial meld")}return!0}function C(a,b,c){for(var d=0,e=0;e<b.length;e++){for(var f=!0,g=0,h=0;h<b[e].length;h++){var i=b[e][h];if(g+=a["tile"+i].score,-1===c.indexOf(i)){f=!1;break}}f&&(d+=g)}return d}function D(a){return-1!==E(a.board,a.deltas)||F(a)}function E(a,b){for(var c=!1,d=-1,e=I();e<a.length;e++)0===a[e].length&&0===b.length?d=e:c===!1&&(c=!0);return c?d:-1}function F(a){return a.trace.nexttile>=106}function G(a,b,c){for(var d=H(b),e=0;e<c.length;e++)if(c[e].tileIndex===a&&c[e].from.row===d)return!0;return!1}function H(a){return I()+a}function I(){return a.GAME_BOARD_ROWS}function J(){return a.GAME_BOARD_COLS}function K(a,b){for(var c=[],d=0,e=0;e<a.length;e++){var f=a[e].tileIndex,g=a[e].from,h=a[e].to;if(g.row===b&&h.row!==b)d++,c.push(f);else if(g.row!==b&&h.row===b){d--;var i=c.indexOf(f);c.splice(i,1)}}return q(c.length===d,"get tiles sent wrong"),c}function L(a,b){for(var c=angular.copy(a),d=O(c,b),e=[],f=0;f<d.length;f++)e=e.concat(d[f]);for(var g=[],h=0;h<c.length;h++)-1===e.indexOf(c[h])&&g.push(c[h]);for(var i=M(g,b),j=0;j<i.length;j++)e=e.concat(i[j]);for(var k=0;k<g.length;k++)-1===e.indexOf(g[k])&&e.push(g[k]);return e}function M(a,b){if(0===a.length)return[];a.sort(S("color",b));for(var c=[],d=R(a[0],b),e=[],f=0;f<a.length;f++){var g=a[f],h=R(g,b);if(h===d&&e.push(g),h!==d||f===a.length-1){var i=N(e,b);i.length>0&&(c=c.concat(i)),d=h,e=[g]}}return c}function N(a,b){for(var c=[],d=Q(a[0],b),e=[],f=0;f<a.length;f++){var g=a[f],h=Q(g,b);d===h?(e.push(g),d+=1):(e.length>=3&&c.push(e),e=[g],d=h+1)}return e.length>=3&&c.push(e),c}function O(a,b){a.sort(S("score",b));for(var c=[],d=Q(a[0],b),e=[],f=0;f<a.length;f++){var g=a[f],h=Q(g,b);if(h===d&&e.push(g),h!==d||f===a.length-1){var i=P(e,b);i.length>0&&(c=c.concat(i)),d=h,e=[g]}}return c}function P(a,b){for(var c=[],d=[],e=[],f=0;f<a.length;f++){var g=a[f],h=R(g,b);-1===d.indexOf(h)&&(d.push(h),e.push(g))}return e.length>=3&&c.push(e),c}function Q(a,b){return q(void 0!==b["tile"+a],"undefined tile: tile"+a),b["tile"+a].score}function R(a,b){return q(void 0!==b["tile"+a],"undefined tile: tile"+a),b["tile"+a].color}function S(a,b){return function(c,d){var e=b["tile"+c],f=b["tile"+d];return"score"===a?e.score-f.score:e.color>f.color?1:e.color<f.color?-1:e.score-f.score}}return{isMoveOk:b,createMove:c,getTileByIndex:v,getPossibleMoves:l,findAllSetInHand:L,sortBy:S,getTilesSentToBoardThisTurn:K,createInitialMove:d,createPickMove:f,createMeldMove:g,createSingleUndoMove:i,createMoveMove:e,createSortMove:h,createCombinedMove:j}}])}();
//# sourceMappingURL=everything.min.js.map